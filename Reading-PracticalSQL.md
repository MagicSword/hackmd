---
title: SQL語法查詢入門｜挖掘數據真相征服大數據時代的第一本書
description: Practical SQL
image: 
tags: reading, sql, postgresql
robots: noindex, nofollow
lang: zh-tw
---

**SQL語法查詢入門｜挖掘數據真相征服大數據時代的第一本書**
Practical SQL

SQL是一種用建立、管理和查詢資料庫的程式語言。無論您是分析師、記者或是從事學術研究的研究人員，都可以運用SQL來發掘隱藏在數據中的故事。

　　本書除了解說SQL以及資料庫的基礎知識之外，還會告訴您如何使用pgAdmin和PostgreSQL資料庫系統來建立、組織和分析真實世界的資料，像是犯罪統計資料或人口普查統計數據，同時也將告訴您如何在資料庫中進行運算，以及排解實際工作過程中常見的障礙。

　　透過本書，您將了解如何：
　　．為您的資料定義正確的數據類型
　　．聚合、排序和過濾數據以查找模式
　　．識別並清除數據中的任何錯誤
　　．搜尋有意義數據的文字
　　．建立進階查詢並自動完成繁瑣的任務
 
<!--more-->


![SQL語法查詢入門｜挖掘數據真相，征服大數據時代的第一本書](https://www.books.com.tw/img/001/082/02/0010820274.jpg =50%x50%)
* [圖書資料](http://www.books.com.tw/products/0010820274)
* 書名：SQL語法查詢入門｜挖掘數據真相征服大數據時代的第一本書
* 原文名稱：Practical SQL
* 語言：繁體中文
* ISBN：9789865020989
* 頁數：472
* 出版社：碁峰
* 作者：Anthony DeBarros
* 譯者：林班侯
* 出版日期：2019/04/29
* 類別：電腦資訊
 
Task list: :smile:

- [x] 初稿
- [ ] 再讀
- [ ] 筆記
- [ ] 完成

# 目錄
第1章｜建立你的第一個資料庫和資料表
初步介紹了PostgreSQL、pgAdmin使用者介面、以及如何將簡易教師資料集匯入到新建資料庫當中。

第2章｜用SELECT 開始探索資料
教各位探索基本的SQL 查詢語法，包括如何排序及篩選資料。

第3章｜了解資料類型
解釋了如何設置資料表欄位來儲存特定型態的資料，從文字到各種形式的數字都有。

第4章｜匯入與匯出資料
說明如何利用SQL 指令從外部檔案載入資料、以及如何加以匯出。各位會試著載入一套美國人口普查資料表，而且後面的章節都會用到它。

第5章｜SQL 的基礎數學計算與統計
涵蓋了算術運算，並介紹各種匯總函式，用來計算總和、平均值及中間值等等。

第6章｜在關聯式資料庫中結合資料表
說明如何透過關鍵欄位結合多個彼此有關聯的資料表、以便進行查詢。各位將學到如何執行結合，也會學到何時應當使用何種結合方式。

第7章｜適合你的資料表設計
涵蓋如何建置資料表才能提升你的資料組織性和正確性，也會告訴各位如何以索引加速查詢。

第8章｜利用群聚（Grouping）和總結（Summarizing）來擷取資訊
說明如何利用匯總函式，從年度調查中找出美國圖書館運用的趨勢。

第9章｜調查與修改資料
會以關於肉品、雞蛋及家禽生產商的記錄資料為例，探討如何找出和修正不完整或不正確的資料。

第10章｜SQL 裡的統計函式
簡介了SQL 中的相關性、回歸及排序等函式，以便讓你從資料中推導出更多結論。

第11章｜日期與時間的處理
以紐約市計程車乘運和美國國鐵（Amtrak）時間表的資料為例，說明在資料庫中如何建立、處理和查詢日期及時間，包括如何處理時區。

第12章｜進階查詢技巧
說明如何使用更繁複的SQL 運算，例如子查詢（subqueries）和交叉製表、以及CASE 敘述，將溫度讀數的資料值重新分類。

第13章｜探勘文字以找出有意義的資料
以美國歷任總統演說辭為例，涵蓋如何利用PostgreSQL 的全文檢索引擎和正規表示式，從雜亂無章的文字中擷取資料。

第14章｜用PostGIS 分析空間資料
介紹了與空間物體有關的資料類型和查詢，讓你可以分析地理特徵，如州境、道路與河流等等。

第15章｜利用檢視表、函式和觸發程序來節省時間
說明如何把資料庫作業自動化，以避免重複性的工作。

第16章｜從指令列操作PostgreSQL
涵蓋如何在你電腦的命令提示畫面使用文字指令，以便連接資料庫並執行查詢。

第17章｜維護你的資料庫
提供若干訣竅與程序，用於追蹤資料庫規模、自訂設定方式、以及備份資料。

第18章｜找出並述說資料背後的故事
提供了基本指南，教大家如何把分析化為概念、如何審閱資料、如何產生結論、以及如何明確地呈現你的發現等等。

附錄A：其他的PostgreSQL 資源
列舉各種可以協助你提升技巧的軟體及文件。


# 導論

# 第1章｜建立你的第一個資料庫和資料表

# 第2章｜用SELECT 開始探索資料
教各位探索基本的SQL 查詢語法，包括如何排序及篩選資料。

# 第3章｜了解資料類型
解釋了如何設置資料表欄位來儲存特定型態的資料，從文字到各種形式的數字都有。

# 第4章｜匯入與匯出資料
說明如何利用SQL 指令從外部檔案載入資料、以及如何加以匯出。各位會試著載入一套美國人口普查資料表，而且後面的章節都會用到它。

* `COPY tablename FROM filename` : 匯入檔案
* `COPY tablename TO filename` : 匯出檔案
* 可匯入部分欄位
* `CREATE TEMPORARY TABLE supervisor_salaries_temp (LIKE supervisor_salaries);` : 暫時 table
* 用 pgAdmin 來匯入，匯出
* `DELETE FROM supervisor_salaries;` : 清空 table


習題
1. 匯入檔案
```SQL
COPY 'movie_file.dat'
SELECT id,movie,actor
FROM 'C:\YourDirectory\us_counties_export.txt'
WITH (FORMAT CSV, HEADER, DELIMITER ':');
```

2. 匯出檔案
```SQL
SELECT geo_name,state_us_abbreviation,housing_unit_count_100_percent
FROM us_counties_2010
ORDER BY  housing_unit_count_100_percent DESC LIMIT 20;
```

3. numeric(3,8) 會出錯，因為 numeric(數字總位數 len,小數點右邊位數 scale)
    * len > scale 

# 第5章｜SQL 的基礎數學計算與統計
涵蓋了算術運算，並介紹各種匯總函式，用來計算總和、平均值及中間值等等。

* 數學運算函數
* (|/ x ) = (x ^ 0.5)
* (||/ x ) = (x ^ 1/3)
* 4! = 1x2x3x4

* `p0010004 AS "Black Alone",` : AS 欄位的別名
* 

# 第6章｜在關聯式資料庫中結合資料表
說明如何透過關鍵欄位結合多個彼此有關聯的資料表、以便進行查詢。各位將學到如何執行結合，也會學到何時應當使用何種結合方式。

* 多個 tables 間的串聯，可以減少重複資料出現，正規化？
* [CONSTRAINT 限制條件](https://docs.postgresql.tw/the-sql-language/ddl/constraints) : 限制資料如何被儲存在表格中的方式
    * 例：指定欄位是 ，Primary key, 是 unique
    * ex: `CONSTRAINT emp_key PRIMARY KEY (emp_id),`
    * `CONSTRAINT emp_dept_unique UNIQUE (emp_id, dept_id)`
* `JOIN` 有幾種：
    1. INNER JOIN
    2. LEFT JOIN
    3. RIGHT JOIN
    4. FULL OUTER JOIN
    5. CROSS JOIN 
* 用 `NULL` 找出無效的資料列 。 `NULL` 不是 0 ，不是 "" ， `WHERE schools_right.id IS NULL`
* 資料表關係：
    1. 一對一
    2. 一對多
    3. 多對多 
* 資料表別名：`FROM schools_left AS lt LEFT JOIN schools_right AS rt`
* `Foreign Key` 外部鍵值：外來鍵是一個(或數個)指向另外一個表格主鍵的欄位。外來鍵的目的是確定資料的參考完整性 (Referential Integrity)。換言之，只有被准許的資料值才會被存入資料庫內
* 用 `REFERENCES` 關鍵字 指定外來鍵
* ex: `dept_id integer REFERENCES departments (dept_id),`
 

習題
1. 找出消失的郡治 
```sql
SELECT c2000.geo_name,c2000.county_fips,c2010.geo_name,c2010.county_fips
FROM us_counties_2000 c2000 left join us_counties_2010 c2010
on c2000.county_fips = c2010.county_fips
where c2010.county_fips is null;
```
2. ?
3. ?


# 第7章｜適合你的資料表設計
涵蓋如何建置資料表才能提升你的資料組織性和正確性，也會告訴各位如何以索引加速查詢。

* 資料表設計
* 命名：建議使用 smooth_name ，單字用底線連接
    * 命名要簡單，不要有奇怪的縮寫
    * 資料表都用複數型態：teachers, vehicles,counties
    * 注意命名長度上限：iso SQL 上限128, PostgreSQL 上限 63, Oracle 上限 30
    * 複製資料表時，加上日期，以便之後管理
* 使用 約束條件 ，來控制欄位值(或驗證欄位值)
    * CHECK : 檢查資料
    * UNIQUE : 欄位是唯一的
    * NOT NULL : 欄位不能是 NULL
* 主鍵(PRIMARY KEY)：獨一無二，用來代表資料
    * 唯一
    * 不能是 NULL
    * 能分為 自然型、代理型
        * 自然型：既有欄位，像是 身份證字號，ISBN，產品EAN13，流水，…資料中就有可代表資料、唯一值的欄位
        * 代理型：原有資料中沒有有用的欄位能當主鍵，那就生成一個唯一的值，以代表資料，像是： UUID
    * 鍵值類型的優缺點：
        * 自然鍵，用已有欄位，不需新建
        * 自然鍵是有意義的
        * 代理鍵本身無意義，資料表異動後，也不會受限於鍵值結構。
        * 代理鍵常用整數，用的空間較自然鍵少
* 複合主鍵：單一欄位無法代表資料，ex: 學生id, 出席日期
* 自動遞增的代理鍵值： serial 系列的類型( smallserial,serial,bigserial)
    * UUID : [安裝，使用 UUID 模組](http://etrex.blogspot.com/2017/03/postgresql-uuid.html)
    * 安裝模組：`CREATE EXTENSION "uuid-ossp";`
    * 移除模組：`DROP EXTENSION "uuid-ossp";`
    * 使用：`select uuid_generate_v4()`
    * 查目前安裝的模組：`select * from pg_extension;`
    * 查看可安裝模組：`select * from pg_available_extensions;`
* 外部鍵值 `REFERENCES`:
    * ex: `license_id varchar(10) REFERENCES licenses (license_id),`
* `CASCADE` : 刪除某筆資料後，與其參照之相關資料列，自動刪除
    * ex: `license_id varchar(10) REFERENCES licenses (license_id) ON CASCADE,`
* `CHECK` : 驗證輸入資料
    * `CONSTRAINT check_salary_not_zero CHECK (salary > 0)`
    * `CONSTRAINT` 宣告限制變數， `check_salary_not_zero` 是限制變數
* `UNIQUE` 唯一
    * `CONSTRAINT email_unique UNIQUE (email)`
* `NOT NULL` 非無效值
    * `first_name varchar(50) NOT NULL,`
* `ALTER TABLE` 可以修正資料表
    * 增減限制
        * `ALTER TABLE not_null_example DROP CONSTRAINT student_id_key;`
        * `ALTER TABLE not_null_example ADD CONSTRAINT student_id_key PRIMARY KEY (student_id);`
    * 增減欄位
        * `ALTER TABLE not_null_example ALTER COLUMN first_name DROP NOT NULL;`
        * `ALTER TABLE not_null_example ALTER COLUMN first_name SET NOT NULL;`
* [isn](https://www.postgresql.org/docs/9.1/isn.html) : International Product Numbering Standards, EAN13, ISBN, ISBN13
* 加上索引(Index)，來加速查詢 (PostgreSQL 預設索引用 B-Tree), PostgreSQL 有幾種 Index
    * B-Tree 是樹狀結構，是 [平衡樹](https://zh.wikipedia.org/wiki/%E5%B9%B3%E8%A1%A1%E6%A0%91)
    * GIN: Generalized Inverted Index
    * GiST:Generalized Search Tree
* `EXPLAIN ANALYZE`: Benchmark 資料查詢的速度
    * ex: 
    ```sql
    EXPLAIN ANALYZE SELECT * FROM new_york_addresses
    WHERE street = 'BROADWAY';
    ```
* 建立 Index : `CREATE INDEX street_idx ON new_york_addresses (street);`
* 有 Index 後，查詢速度快很多
* 移除 Index: `DROP IDNEX street_idx`
* 使用 Index 時機：
    * 使用適合的 Index: ex: GiST 地理資料用
    * PRIMARY KEY 適合加上 Index , 但是 FOREIGN KEY 不適
    * 常用到 WHERE 子句，可考慮加上 INDEX
    * 不確定的話，多用 `EXPLAIN ANALYZE` 來試


# 第8章｜利用群聚（Grouping）和總結
（Summarizing）來擷取資訊 說明如何利用匯總函式，從年度調查中找出美國圖書館運用的趨勢。

* Grouping  , summary

# 第9章｜調查與修改資料 
會以關於肉品、雞蛋及家禽生產商的記錄資料為例，探討如何找出和修正不完整或不正確的資料。

* 調查與修改資料 
* 

# 第10章｜SQL 裡的統計函式 
簡介了SQL 中的相關性、回歸及排序等函式，以便讓你從資料中推導出更多結論。

* 統計函式 


# 第11章｜日期與時間的處理 
以紐約市計程車乘運和美國國鐵（Amtrak）時間表的資料為例，說明在資料庫中如何建立、處理和查詢日期及時間，包括如何處理時區。

* 日期與時間的處理


# 第12章｜進階查詢技巧 
說明如何使用更繁複的SQL 運算，例如子查詢（subqueries）和交叉製表、以及CASE 敘述，將溫度讀數的資料值重新分類。


* 進階查詢技巧




# 第13章｜探勘文字以找出有意義的資料 
以美國歷任總統演說辭為例，涵蓋如何利用PostgreSQL 的全文檢索引擎和正規表示式，從雜亂無章的文字中擷取資料。


* 探勘文字


# 第14章｜用PostGIS 分析空間資料 
介紹了與空間物體有關的資料類型和查詢，讓你可以分析地理特徵，如州境、道路與河流等等。


* PostGIS 分析空間資料



# 第15章｜利用檢視表、函式和觸發程序來節省時間 說明如何把資料庫作業自動化，以避免重複性的工作。

# 第16章｜從指令列操作PostgreSQL 
涵蓋如何在你電腦的命令提示畫面使用文字指令，以便連接資料庫並執行查詢。

* 利用檢視表


# 第17章｜維護你的資料庫 
提供若干訣竅與程序，用於追蹤資料庫規模、自訂設定方式、以及備份資料。

* 維護你的資料庫

# 第18章｜找出並述說資料背後的故事 
提供了基本指南，教大家如何把分析化為概念、如何審閱資料、如何產生結論、以及如何明確地呈現你的發現等等。

# 附錄A：其他的PostgreSQL 資源 
列舉各種可以協助你提升技巧的軟體及文件。


# 參考資料
1. [book github](https://github.com/anthonydb/practical-sql)
2. [book site](https://practicalsqlbook.com/)
3. [boos at google book](https://books.google.com.tw/books?id=n7SeDwAAQBAJ&printsec=frontcover&hl=zh-TW)
4. [PostgreSQL 中文文件](https://docs.postgresql.tw/)
5. [PostgreSQL at W3cresource](https://w3resource.com/PostgreSQL/tutorial.php "PostgreSQL Tutorial")
6. [2019鐵人賽：以Postgresql為主,聊聊資料庫. 系列](https://ithelp.ithome.com.tw/users/20050647/ironman/2818 "2019鐵人賽：以Postgresql為主,聊聊資料庫. 系列")
7. 



[google]: https://www.google.com "Search Engine"